# Codemap Diff Report
Generated: 2026-02-20
Previous Update: 2026-01-29

## Summary

**Diff Percentage: ~35%** (significant changes requiring update)

The codemaps have been updated to reflect structural changes made between 2026-01-29 and 2026-02-20.

## Changes by File

### architecture.md
- Updated service count: 19 → 21 services (added EmbeddingService, ContextRetrievalService)
- Settings refactored from single `settings.py` to `settings/` package (8 modules)
- Added RAG context pipeline diagram
- Updated world_quality_service module count: 9 → 20
- Updated world_service module count: 6 → 10
- Updated world_database module count: 7 → 11
- Added new key patterns: Settings Backup, RAG Pipeline, Lifecycle Data
- Updated total code statistics: 129 files → 222 files, ~45,269 → ~73,487 lines

### backend.md
- Added RAG Services section (EmbeddingService, ContextRetrievalService)
- Updated world_quality_service breakdown: 9 → 20 modules (~4,732 → ~8,061 lines)
- Updated world_service breakdown: 6 → 10 modules (~2,113 → ~3,420 lines)
- Updated world_database breakdown: 7 → 11 modules (~2,600 → ~3,787 lines)
- Added Settings Package section (8 modules, replaces single settings.py)
- Updated orchestrator module details (_writing.py now 615 lines with timeline context)
- Added new utilities: Circuit Breaker, SQLite Vec Loader, Streaming, Similarity
- Fixed prompt template count: "60+" → 42 actual templates
- Removed incorrect world_quality template directory (prompts are inline in code)

### frontend.md
- Updated settings/ page package: 7 → 8 modules (added _world_validation.py)
- Updated line counts across all page packages
- Updated WorldHealthDashboard: now includes temporal metrics (573 lines)
- Updated standalone pages line counts
- Updated code statistics totals

### data.md
- Added lifecycle/temporal data note on Entity attributes
- Updated settings file storage with auto-backup info
- No schema changes

## Notable New Files Since Last Update

### Services
- `src/services/world_quality_service/_calendar.py` (462 lines)
- `src/services/world_quality_service/_entity_delegates.py` (170 lines)
- `src/services/world_quality_service/_event.py` (360 lines)
- `src/services/world_quality_service/_quality_loop.py` (514 lines)
- `src/services/world_quality_service/_analytics.py` (171 lines)
- `src/services/world_quality_service/_common.py` (209 lines)
- `src/services/world_quality_service/_chapter_quality.py` (326 lines)
- `src/services/world_quality_service/_plot.py` (246 lines)
- `src/services/world_quality_service/_model_cache.py` (233 lines)
- `src/services/world_quality_service/_model_resolver.py` (181 lines)
- `src/services/world_quality_service/_formatting.py` (132 lines)
- `src/services/world_service/_event_helpers.py` (305 lines)
- `src/services/world_service/_orphan_recovery.py` (181 lines)
- `src/services/world_service/_lifecycle_helpers.py` (154 lines)
- `src/services/world_service/_name_matching.py` (69 lines)

### Settings
- `src/settings/_backup.py` (172 lines) — auto-backup before writes

### Memory
- `src/memory/world_database/_attributes.py` (106 lines)
- `src/memory/world_database/_cycles.py` (116 lines)
- `src/memory/world_database/_schema.py` (231 lines)
- `src/memory/world_database/_embeddings.py` (425 lines)

### UI
- `src/ui/pages/settings/_world_validation.py` (301 lines)

## Code Statistics Comparison

| Metric | Previous (Jan 29) | Current (Feb 20) | Change |
|--------|-------------------|-------------------|--------|
| Total Services | 19 | 21 | +2 |
| Total Source Files | 129 | 222 | +93 |
| Total Lines | ~45,269 | ~73,487 | +28,218 |
| Services Lines | ~15,270 | ~25,415 | +10,145 |
| Memory Lines | ~11,932 | ~14,269 | +2,337 |
| UI Lines | ~15,567 | ~23,453 | +7,886 |
| Settings Lines | ~1,282 | ~2,600 | +1,318 |

## Verification Checklist

- [x] architecture.md updated with new services and patterns
- [x] backend.md updated with expanded service packages
- [x] frontend.md updated with new settings module
- [x] data.md updated with lifecycle/temporal notes
- [x] Freshness timestamps updated to 2026-02-20
- [x] RAG pipeline documented
- [x] Settings package refactor documented
- [x] Event generation system documented
- [x] Prompt template count corrected to 42
